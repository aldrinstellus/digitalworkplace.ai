# Digital Workplace AI - Performance Optimization Plan

**Analysis Date**: 2026-01-27
**Current Score**: ~60/100 (needs improvement)
**Target Score**: 90/100

---

## Executive Summary

| Page | TTFB | FCP | LCP | Status |
|------|------|-----|-----|--------|
| Sign-in | 1200ms | 2244ms | ~3000ms | ❌ Needs Work |
| Dashboard | TBD | TBD | TBD | Pending Analysis |

---

## Critical Issues

### 1. TTFB Too Slow (1200ms → <200ms target)

**Problem**: Server response time is 1.2 seconds before browser receives first byte.

**Solutions**:
```typescript
// next.config.ts - Add edge runtime for auth pages
export const config = {
  runtime: 'edge',
};

// Or use static generation where possible
export const dynamic = 'force-static';
```

**Quick Win**: Add `stale-while-revalidate` caching:
```typescript
async headers() {
  return [{
    source: '/sign-in',
    headers: [{
      key: 'Cache-Control',
      value: 'public, s-maxage=60, stale-while-revalidate=300'
    }]
  }];
}
```

### 2. JavaScript Bundle Too Large (539KB → <300KB target)

**Problem**: Total JS is 539KB, with Clerk SDK alone being 250KB.

**Solutions**:

a) **Lazy load Clerk SDK** (save ~200KB on initial load):
```typescript
// Dynamic import Clerk only when needed
const SignInWithClerk = dynamic(
  () => import('@clerk/nextjs').then(mod => mod.SignIn),
  { ssr: false, loading: () => <Spinner /> }
);
```

b) **Code split GSAP and Framer Motion**:
```typescript
// Only load animation libraries after first paint
const [animationsReady, setAnimationsReady] = useState(false);
useEffect(() => {
  const timer = setTimeout(() => setAnimationsReady(true), 100);
  return () => clearTimeout(timer);
}, []);
```

c) **Tree-shake unused code**:
```javascript
// Instead of:
import { gsap } from "gsap";
// Use:
import gsap from "gsap/dist/gsap";
```

### 3. Too Many Avatar Images (24 images → progressive loading)

**Problem**: 24 external images = 24 HTTP requests + ~120KB

**Solutions**:

a) **Use image sprites or CSS avatars for initial load**:
```typescript
// Only load first 6 avatars, lazy load rest
const [visibleAvatars, setVisibleAvatars] = useState(6);
useEffect(() => {
  const timer = setTimeout(() => setVisibleAvatars(24), 1000);
  return () => clearTimeout(timer);
}, []);
```

b) **Use Next.js Image with blur placeholder**:
```typescript
<Image
  src={avatar.src}
  alt={avatar.name}
  width={80}
  height={80}
  loading={index < 6 ? "eager" : "lazy"}
  placeholder="blur"
  blurDataURL={avatarBlurDataURL}
  priority={index < 6}
/>
```

c) **Host avatars on CDN** (instead of Unsplash):
- Upload to Vercel Blob or similar
- Single domain = connection reuse
- Can use HTTP/2 multiplexing

### 4. Animations Blocking Paint

**Problem**: GSAP and Framer Motion compete for CPU during load.

**Solutions**:

a) **Defer animations until after LCP**:
```typescript
const [isLCPComplete, setIsLCPComplete] = useState(false);

useEffect(() => {
  // Wait for LCP before starting animations
  const observer = new PerformanceObserver((list) => {
    if (list.getEntries().length > 0) {
      setIsLCPComplete(true);
    }
  });
  observer.observe({ type: 'largest-contentful-paint', buffered: true });
  return () => observer.disconnect();
}, []);

// Only render animations after LCP
{isLCPComplete && <AnimatedBackground />}
```

b) **Use CSS animations instead of JS for simple effects**:
```css
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
.avatar { animation: float 4s ease-in-out infinite; }
```

---

## Implementation Priority

### Phase 1: Quick Wins (1-2 hours)
1. [ ] Add caching headers for sign-in page
2. [ ] Reduce initial avatar count to 6
3. [ ] Add `loading="lazy"` to below-fold images

### Phase 2: Bundle Optimization (2-4 hours)
1. [ ] Dynamic import Clerk SDK
2. [ ] Code split animation libraries
3. [ ] Tree-shake GSAP imports

### Phase 3: Architecture Changes (4-8 hours)
1. [ ] Move to edge runtime for auth pages
2. [ ] Host avatars on CDN
3. [ ] Implement proper LCP deferral

---

## Expected Results

| Metric | Before | After Phase 1 | After All |
|--------|--------|---------------|-----------|
| TTFB | 1200ms | 800ms | <200ms |
| FCP | 2244ms | 1500ms | <1000ms |
| LCP | ~3000ms | 2000ms | <1500ms |
| JS Size | 539KB | 400KB | <300KB |
| Lighthouse | ~60 | ~75 | ~90+ |

---

## Monitoring

Add these to track improvements:
```typescript
// Report Core Web Vitals
import { onLCP, onFID, onCLS } from 'web-vitals';

onLCP(console.log);
onFID(console.log);
onCLS(console.log);
```

---

*Generated by Claude Code Performance Analysis*
